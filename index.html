<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; margin: 0; padding-bottom: 80px; }
        .page { display: none; padding: 20px; }
        .active { display: block; }
        .card { background: #1e293b; padding: 20px; border-radius: 15px; margin: 10px; border: 1px solid #38bdf8; }
        .nav { position: fixed; bottom: 0; width: 100%; background: #1e293b; display: flex; justify-content: space-around; padding: 15px 0; }
        .btn { background: #38bdf8; color: #0f172a; border: none; padding: 10px 20px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .dragon { width: 150px; margin: 20px; }
    </style>
</head>
<body>

    <div id="mine" class="page active">
        <div class="card">
            <h2 id="bakiye">0.00</h2>
            <p>HÄ±z: +<span id="hiz">0</span>/saat</p>
        </div>
        <img class="dragon" src="https://img.freepik.com/free-vector/cute-dragon-sleeping-cartoon-vector-icon-illustration_138676-3918.jpg">
        <button class="btn" style="background:#f59e0b" onclick="claimDaily()">ğŸ GÃ¼nlÃ¼k Bonus</button>
    </div>

    <div id="leader" class="page">
        <h3>ğŸ† En Ä°yi 5</h3>
        <div id="leader-list">YÃ¼kleniyor...</div>
    </div>

    <div id="shop" class="page">
        <h3>ğŸ›’ Market</h3>
        <div class="card">
            <h4>Bebek Ejderha</h4>
            <p>100 ğŸ’ | +10 HÄ±z</p>
            <button class="btn" onclick="buy(100, 10)">SatÄ±n Al</button>
        </div>
    </div>

    <div class="nav">
        <div onclick="tab('mine')">â›ï¸ Maden</div>
        <div onclick="tab('leader')">ğŸ† Liderler</div>
        <div onclick="tab('shop')">ğŸ›’ Market</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : "test";
        const dbURL = "https://sleepyton-3b15d-default-rtdb.europe-west1.firebasedatabase.app/";
        let state = { bakiye: 0, hiz: 0, lastSync: Date.now() };

        function load() {
            fetch(`${dbURL}/users/${userId}.json`).then(r => r.json()).then(data => {
                if(data) state = data;
                update();
            });
        }

        function update() {
            document.getElementById('bakiye').innerText = state.bakiye.toFixed(2) + " ğŸ’";
            document.getElementById('hiz').innerText = state.hiz;
        }

        function save() {
            state.lastSync = Date.now();
            fetch(`${dbURL}/users/${userId}.json`, { method: 'PUT', body: JSON.stringify(state) });
        }

        function buy(f, a) {
            if(state.bakiye >= f) {
                state.bakiye -= f; state.hiz += a;
                update(); save(); alert("BaÅŸarÄ±lÄ±!");
            } else alert("Yetersiz!");
        }

        function claimDaily() {
            state.bakiye += 500; update(); save(); alert("500 AlÄ±ndÄ±!");
        }

        function tab(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(id === 'leader') {
                fetch(`${dbURL}/users.json`).then(r => r.json()).then(all => {
                    let top = Object.values(all).sort((a,b) => b.bakiye - a.bakiye).slice(0,5);
                    document.getElementById('leader-list').innerHTML = top.map((u,i) => `<div>${i+1}. ${u.bakiye.toFixed(0)} ğŸ’</div>`).join('');
                });
            }
        }

        setInterval(() => { if(state.hiz > 0) { state.bakiye += (state.hiz/3600); update(); } }, 1000);
        setInterval(save, 15000);
        window.onload = load;
    </script>
</body>
</html>
